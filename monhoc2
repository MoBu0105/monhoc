#include <iostream>
#include <conio.h>
#include <Windows.h>
#include <string>
#include <fstream>
#include <sstream>

using namespace std;

int xd = 5, yd = 1, d = 10, stop;

//Cau truc
struct monhoc {
	char msmh[6];
	char ten[10];
	int stc, lt, th, tuh;
};

//gotoxy
void xy(int x, int y)
{
	COORD td;

	td.X = x;
	td.Y = y;

	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), td);
}

//doc file
int readfile(string f, monhoc n[], int& sl)
{
	int i = 0;
	ifstream file(f.c_str());

	if (!file.is_open())
		return 1;

	string line;
	getline(file, line);

	while (getline(file, line))
	{
		stringstream ss(line);

		ss.getline(n[i].msmh, 6, ',');
		ss.getline(n[i].ten, 10, ',');
		ss >> n[i].stc;
		ss >> n[i].lt;
		ss >> n[i].th;
		ss >> n[i].tuh;

		i++;
	}

	sl = i;

	return 0;
}

//menu chinh
string mn[] = {
	"CHUONG TRINH QUAN LY MON HOC",
	"1. In danh sach cac mon hoc",
	"2. Them mon hoc",
	"3. Xoa mon hoc",
	"4. Cap nhat mon hoc",
	"5. Tim kiem mon hoc",
	"6. Xap sep mon hoc",
	"7. Thoat chuong trinh"
};

//menu cap nhat
string mn_cn[] = {
	"CAP NHAT THONG TIN",
	"1. Cap nhat MSMN",
	"2. Cap nhat ten mon hoc",
	"3. Cap nhat so tin chi",
	"4. Cap nhat so gio ly thuyet",
	"5. Cap nhat so gio thuc hanh",
	"6. Cap nhat so gio tu hoc",
	"7. Cap nhat tat ca",
	"8. Thoat",
};

//menu tim kiem
string mn_tk[] = {
	"CHON PHUONG PHAP TIM KIEM"
	"1. liner",
	"2. Binary",
	"3. Thoat"
};

//menu tim kiem 2
string mn_tk2[] = {
	"CHON TIM KIEM THEO",
	"1. MSMH",
	"2. Ten mon hoc",
	"3. So tin chi",
	"4. So gio ly thuyet",
	"5. So gio thuc hanh",
	"6. So gio tu hoc",
	"7. Thoat"
};

//in menu
void inmn(string m[], int s, int x, int y)
{
	xy(x + 3.75 * d, y);
	cout << m[0];
	y++;
	for (int i = 1; i < s; i++)
	{
		xy(x + 3.75 * d, y);
		cout << m[i];
		y++;
	}
	y++;
	xy(x + 3.75 * d, y);
	cout << "Chon thao tac: ";
}

//in tieu de
void intd(int x, int& y)
{
	xy(x + 3.755 * d, y);
	cout << "-----THONG TIN MON HOC-----";
	y++;
	xy(x, y);
	cout << "STT";
	xy(x + 0.6 * d, y);
	cout << "MSMH";
	xy(x + 1.5 * d, y);
	cout << "Ten mon hoc";
	xy(x + 3 * d, y);
	cout << "So tin chi";
	xy(x + 4.25 * d, y);
	cout << "So gio ly thuyet";
	xy(x + 6.25 * d, y);
	cout << "So gio thuc hanh";
	xy(x + 8.25 * d, y);
	cout << "So gio tu hoc";
}

//in 1 mon hoc
void inmh(monhoc m, int x, int& y)
{
	xy(x + 0.6 * d, y);
	cout << m.msmh;
	xy(x + 1.5 * d, y);
	cout << m.ten;
	xy(x + 3 * d, y);
	cout << m.stc;
	xy(x + 4.25 * d, y);
	cout << m.lt;
	xy(x + 6.25 * d, y);
	cout << m.th;
	xy(x + 8.25 * d, y);
	cout << m.tuh;
}

//in danh sach
void inds(monhoc m[], int sl, int x, int& y)
{
	intd(x, y);
	y++;
	for (int i = 0; i < sl; i++)
	{
		xy(x, y);
		cout << i+1;
		inmh(m[i], x, y);
		y++;
	}
	y = 1;
}

//them mon hoc
void them(monhoc m[], int& sl)
{
	sl++;
	int vt = 1;
	char yn = 'n';

	do {
		system("cls");
		if (sl == 10)
			cout << "Danh sach da day!";
		else
		{
			do {
				system("cls");
				if (vt<1 || vt>sl)
					cout << "vi tri khong hop le!\nvui long nhap lai";
				cout << "\n\nchon vi tri muon them: ";
				cin >> vt;
				cin.ignore();
			} while (vt<1 || vt>sl + 1);

			for (int i = sl - 1; i >= vt; i--)
				m[i] = m[i - 1];

			cout << "MSMH: ";
			cin >> m[vt - 1].msmh;
			cout << "Ten mon hoc: ";
			cin >> m[vt - 1].ten;
			cout << "So tin chi: ";
			cin >> m[vt - 1].stc;
			cout << "So gio ly thuyet: ";
			cin >> m[vt - 1].lt;
			cout << "So gio thuc hanh: ";
			cin >> m[vt - 1].th;
			cout << "So gio tu hoc: ";
			cin >> m[vt - 1].tuh;

			cout << "\nCo them tiep khong (Y/N): ";
			cin >> yn;
		}
	} while (yn == 'y' || yn == 'Y');

	cout << "\n Nhan phim bat ki de quay ve menu chinh...";
}

//xoamonhoc
void xoa(monhoc m[], int& sl)
{
	int vt = 1;
	char yn;

	do {
		do {
			system("cls");
			if (vt<1 || vt>sl)
				cout << "vi tri khong hop le!\nvui long nhap lai";
			cout << "\n\nchon vi tri muon xoa: ";
			cin >> vt;
			cin.ignore();
		} while (vt<1 || vt>sl);

		for (int i = vt - 1; i < sl; i++)
			m[i] = m[i + 1];
		sl--;

		cout << "\nCo xoa tiep khong (Y/N): ";
		cin >> yn;
	} while (yn == 'y' || yn == 'Y');

	cout << "\n Nhan phim bat ki de quay ve menu chinh...";
}

//cap nhat
void cn(monhoc m[], int sl)
{
	int stt = 1, chon;
	char yn = 'n';

	do {
		do {
			system("cls");
			if (stt<1 || stt>sl)
				cout << "so thu tu khong hop le!\nvui long nhap lai";
			cout << "\n\nchon so thu tu mon hoc muon cap nhat: ";
			cin >> stt;
			cin.ignore();
		} while (stt<1 || stt>sl);

		system("cls");
		inmn(mn_cn, size(mn_cn), xd, yd);
		cin >> chon;
		cin.ignore();

		switch (chon)
		{
		case 1:
			system("cls");
			cout << "\nMSMH moi: ";
			cin.getline(m[stt - 1].msmh, 6);
			stop = _getch();
			break;
		case 2:
			system("cls");
			cout << "\nTen mon hoc moi: ";
			cin.getline(m[stt - 1].ten, 6);
			stop = _getch();
			break;
		case 3:
			system("cls");
			cout << "\nSo tin chi moi: ";
			cin >> m[stt - 1].stc;
			break;
		case 4:
			system("cls");
			cout << "\nSo gio ly thuyet moi: ";
			cin >> m[stt - 1].lt;
			break;
		case 5:
			system("cls");
			cout << "\nSo gio thuc hanh moi: ";
			cin >> m[stt - 1].th;
			break;
		case 6:
			system("cls");
			cout << "\nSo gio tu hoc moi: ";
			cin >> m[stt - 1].tuh;
			break;
		case 7:
			system("cls");
			cout << "\nMSMH moi: ";
			cin.getline(m[stt - 1].msmh, 6);
			cout << "\nTen mon hoc moi: ";
			cin.getline(m[stt - 1].ten, 6);
			cout << "\nSo tin chi moi: ";
			cin >> m[stt - 1].stc;
			cout << "\nSo gio ly thuyet moi: ";
			cin >> m[stt - 1].lt;
			cout << "\nSo gio thuc hanh moi: ";
			cin >> m[stt - 1].th;
			cout << "\nSo gio tu hoc moi: ";
			cin >> m[stt - 1].tuh;
		}
		if (chon != 8)
		{
			cout << "\nDa cap nhat thanh cong co lam tiep khong (Y/N): ";
			cin >> yn;
		}
	} while (yn == 'y' || yn == 'Y');

	cout << "\n\nNhan phim bat ki de quay ve menu chinh...";
}

// tim kiem theo liner
void tk_liner(monhoc m[], int sl)
{
	int chon, luu[10], sl2 = -1, x = 0;
	char chu[50];

	do {
		system("cls");
		inmn(mn_tk2, size(mn_tk2), xd, yd);
		cin >> chon;
		cin.ignore();

		switch (chon)
		{
		case 1:
			system("cls");
			cout << "Nhap MSMH can tim: ";
			cin.getline(chu, 50);
			for (int i = 0; i < sl; i++)
			{
				if (strcmp(m[i].msmh, chu) == 0)
				{
					sl2++;
					luu[sl2] = i;
					x = 1;
				}

				stop = _getch();

			}
		case 2:
		case 3:
		case 4:
		case 5:
		case 6:
		}
	} while (chon != 7);

}

//tim kiem
void tk(monhoc m[], int sl)
{
	int so, chon;
	char yn;

	do {
		do {
			system("cls");
			inmn(mn_tk, size(mn_tk), xd, yd);
			cin >> chon;

			switch (chon)
			{
			case 1:
				system("cls");

				stop = _getch();
				break;
			case 2:
			}

		} while (chon != 3);

	}while (yn == 'y' || yn == 'Y');
}

int main()
{
	monhoc ds[10];
	string filein = "thongtin.txt";
	int sl, chon1, chon2;

	if (readfile(filein, ds, sl) == 1)
	{
		cout << "Khong doc duoc file!";
		stop = _getch();
	}

	do {
		system("cls");
		inmn(mn, size(mn), xd, yd);
		cin >> chon1;
		switch (chon1)
		{
		case 1:
			system("cls");
			inds(ds, sl, xd, yd);
			stop = _getch();
			break;
		case 2:
			system("cls");
			them(ds, sl);
			stop = _getch();
			break;
		case 3:
			system("cls");
			xoa(ds, sl);
			stop = _getch();
			break;
		case 4:
			system("cls");
			cn(ds, sl);
			stop = _getch();
			break;
		case 5:

		}

	} while (chon1 != 7);

	stop = _getch();
	return 0;
}
